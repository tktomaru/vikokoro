# M0: Core editor (DOM/SVG, keyboard-first)

## Goal
- 右方向ツリー（左=親、右=子）
- Tab/Enter/vim操作でノード追加・移動・編集
- タブ（複数ドキュメント）切替
- Undo/Redo（編集確定時に積む）

## Non-goals (M0ではやらない)
- 折りたたみ
- 自動レイアウト最適化（きれいさは後で）
- 同期/クラウド
- 検索

## UX spec (must)
### Modes
- Normal / Insert
- `i` で Insert、`Esc` で確定して Normal に戻る
- Insert中は hjkl / Tab / Enter などの操作ショートカットを無効化（入力優先）

### Keys (Normal)
- `Tab`: 右に **子** 追加 → そのノードを選択し **即 Insert**
- `Enter`: 下に **兄弟** 追加 → そのノードを選択し **即 Insert**
- `h`: 親へ
- `l`: 子(先頭)へ（いなければ何もしない）
- `j/k`: 兄弟の下/上へ
- `J/K`: 兄弟の順序を下/上へ入れ替え（swap）
- `u`: Undo
- `Ctrl+r`: Redo
- `Ctrl+Tab` / `Ctrl+Shift+Tab`: 次/前のドキュメント（タブ切替）

### Node selection style
- 選択中ノードは **枠線**（アクセントカラー、1-2px）

## Data model
- Workspace
  - tabs: [{ docId, title }]
  - activeDocId
  - documents: { [docId]: Document }
- Document
  - rootId
  - cursorId
  - nodes: { [id]: Node }
- Node
  - id, text, parentId|null, childrenIds: string[]

## Undo/Redo (M0)
- Snapshot方式（State丸ごと）
- 積むタイミング: **編集確定時（Esc）** / ノード追加確定時（追加直後の自動Insert→Escで確定時）
- Stack:
  - undoStack: DocumentState[]
  - redoStack: DocumentState[]

## Implementation notes
- DOM + SVG lines（線はM0では簡易でもOK）
- 編集は選択ノードの上に `<input>` を absolute overlay（IME安定）
- レイアウトは簡易:
  - depthごとにx固定
  - siblingsは一定dyで縦並び
  - 親は子群の中央（可能なら）

## Acceptance criteria
- Tab/Enterでノードが追加され、即編集できる
- hjkl と j/k で移動できる
- J/K で兄弟順が入れ替わる
- Escで編集確定し、Undoで戻りRedoで進める
- 上部タブでドキュメント切替できる（最低2枚作れる）
