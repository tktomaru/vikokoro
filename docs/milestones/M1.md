# M1: Persistence & Workspace

## Goal
- Workspace / Documents を永続化
- アプリ再起動時に自動復元
- タブの追加・閉じる
- Undo/Redo をドキュメント単位で安定させる

## UX spec
### Tabs
- 上部タブバー（M0継続）
- `Ctrl+T`: 新規ドキュメント（空のroot）
- `Ctrl+W`: 現在のタブを閉じる
- 最低1タブは常に存在（最後は閉じられない）
- タブ名は root ノードの text を表示（空なら "Untitled"）

### Persistence
- 保存単位: Workspace
- 保存場所: Tauri app data dir
- 起動時:
  - 保存データがあれば自動復元
  - なければ初期Workspace生成

### Save timing
- 自動保存のみ（明示的Save UIなし）
- トリガー:
  - 編集確定（Esc）
  - ノード追加確定
  - タブ追加/削除
  - Undo / Redo 実行後

## Data model (update)
- Workspace
  - tabs: [{ docId }]
  - activeDocId
  - documents: { [docId]: Document }
- Document
  - id
  - rootId
  - cursorId
  - nodes
  - undoStack
  - redoStack

※ Undo/Redo は Document ごとに独立

## Rust side (Tauri)
- コマンド:
  - load_workspace() -> Workspace | null
  - save_workspace(workspace)
- JSON serialize / deserialize
- フロントは state 変更後に save を呼ぶ

## Acceptance criteria
- 再起動後、前回のタブ・内容・選択位置が復元される
- Ctrl+T で新規マップが開ける
- Ctrl+W でタブを閉じられる（最後の1つは不可）
- Undo/Redo が他タブに影響しない
